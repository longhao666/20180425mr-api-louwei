CMAKE_MINIMUM_REQUIRED(VERSION 2.8.0)

SET(LIB_NAME mrapi)
SET(${LIB_NAME}_SOURCE_DIR .)

PROJECT(${LIB_NAME} C)

MESSAGE("${LIB_NAME}_SOURCE_DIR : ${${LIB_NAME}_SOURCE_DIR}")

SET(EXECUTABLE_OUTPUT_PATH ${${LIB_NAME}_SOURCE_DIR}/bin)
SET(LIBRARY_OUTPUT_PATH    ${${LIB_NAME}_SOURCE_DIR}/lib)

#ADD_DEFINITIONS(-DXENOMAI)
#ADD_DEFINITIONS(-DNOT_USE_DYNAMIC_LOADING)

FIND_PACKAGE(Threads REQUIRED)

FIND_LIBRARY(PCAN_LIB_LIBRARY  		 NAMES pcan PATHS /usr/lib     NO_DEFAULT_PATH)  #libpcan.so
  
INCLUDE_DIRECTORIES(${${LIB_NAME}_SOURCE_DIR}/include)
INCLUDE_DIRECTORIES(${${LIB_NAME}_SOURCE_DIR}/drivers/can_peak_linux)

#LINK_DIRECTORIES(${${LIB_NAME}_SOURCE_DIR}/INSTALL/lib/)

SET(SRC_SRCS
	${${LIB_NAME}_SOURCE_DIR}/src/module.c
	${${LIB_NAME}_SOURCE_DIR}/src/joint.c
	${${LIB_NAME}_SOURCE_DIR}/src/master.c
)

SET(LIBCF_INCS
	${${LIB_NAME}_SOURCE_DIR}/include/module.h
	${${LIB_NAME}_SOURCE_DIR}/include/joint.h
	${${LIB_NAME}_SOURCE_DIR}/include/master.h
	${${LIB_NAME}_SOURCE_DIR}/drivers/can_peak_linux/can_peak_linux.h
)

SET(DRIVER_SRC
	${${LIB_NAME}_SOURCE_DIR}/drivers/can_peak_linux/can_peak_linux.c
	${${LIB_NAME}_SOURCE_DIR}/drivers/can_peak_linux/thread_linux.c
)

SET(SRCS
	${SRC_SRCS}
	${DRIVER_SRC}
)


ADD_LIBRARY(${LIB_NAME} STATIC ${SRCS})

TARGET_LINK_LIBRARIES(${LIB_NAME} ${PCAN_LIB_LIBRARY})
#TARGET_LINK_LIBRARIES(${LIB_NAME} rtdm)

#SET_TARGET_PROPERTIES(${LIB_NAME} PROPERTIES COMPILE_FLAGS "${XENOMAI_CFLAGS}")
#SET_TARGET_PROPERTIES(${LIB_NAME} PROPERTIES LINK_FLAGS "${XENOMAI_LDFLAGS}")

#INSTALL(TARGETS ${LIB_NAME}
#	#RUNTIME DESTINATION bin
#	LIBRARY DESTINATION lib
#	#ARCHIVE DESTINATION libstatic
#	)
#INSTALL(FILES ${LIBCF_INCS} DESTINATION include/${LIB_NAME})


